<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../XSLT/decoder.xsl"?>

<!-- Copyright (C) JMRI 2022 All rights reserved   -->
<!-- LOCONETLNCVMODE requires 3 elements to address an LNCV module on LocoNet:
1. Article Number (aka type/class ID) = decoder model productID (integer)
2. Module Address (optional, see below)
3. CV number
For processing by JMRI LnOpsProgrammer, elements 1. and 3. are combined in the CV number e.g., "1.3".
Uhlenbrock and Digikeijs/Digirails publish the Article number for each (new) device.
The Uhlenbrock Lissy Receiver #68600 has Article number 6860, which was registered with Uhlenbrock.
See the nearly identical Uhlenbrock_68610_Lissy.xml and
the single receiver Uhlenbrock_68620_Lissy.xml which contains a subset of LNCVs.
Neither could not be combined in 1 file due to the way the art, nr. is encoded in the LNCV.

See LNCV help in help/en/package/jmri/jmrix/loconet/swing/lncvprog/LncvProgPane.shtml -->

<decoder-config xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://jmri.org/xml/schema/decoder-4-15-2.xsd" showEmptyPanes="no">
    <version author="Egbert Broerse" version="1.0" lastUpdated="20220815"/>
    <!-- version 1 - new decoder definition using new programming mode LOCONETLNCVMODE, requires JMRI 4.22 and decoder.4.15.2.xsd -->

    <decoder>
        <family name="Lissy Receiver" mfg="Uhlenbrock Elektronik" type="stationary">
            <model model="Lissy Receiver 68600" productID="6860" formFactor="Stationary" comment="Lissy Receiver">
              <versionCV />
            </model>
        </family>

        <programming direct="no" paged="no" register="no" ops="no">
          <mode>LOCONETLNCVMODE</mode>
        </programming>

        <variables>
            <variable CV="6860.0" item="Long Address" mask="VVVVVVVVVVVVVVVV" default="1" comment="Board address" >
              <decVal min="1" max="4095"/>
              <label xml:lang="it">Indirizzo Primario: </label>
              <label xml:lang="fr">Adresse décodeur: </label>
              <label xml:lang="de">Moduladresse: </label>
              <label xml:lang="nl">Decoderadres: </label>
              <label>Module Address: </label>
              <tooltip>Also used as 1st Sensor Address. Enter as decimal value (0-4095)</tooltip>
            </variable>
            <variable CV="6860.1" item="Sensor 2 Address" mask="VVVVVVVVVVVVVVVV" default="2">
              <decVal min="1" max="4095"/>
              <label xml:lang="de">1. Melderadresse: </label>
              <label xml:lang="nl">Adres melder 2: </label>
              <label>Sensor 2 Address: </label>
              <tooltip>Enter as decimal value (0-4095)</tooltip>
            </variable>

            <variable CV="6860.2" item="Function" default="2">
              <xi:include href="http://jmri.org/xml/decoders/uhlenbrock/enumLissyFunction.xml"/>
              <label>Function Mode:</label>
              <label xml:lang="de">Funktion:</label>
              <label xml:lang="nl">Functie:</label>
              <tooltip>Selection of the different modes</tooltip>
              <tooltip xml:lang="de">Auswahl der verschiedenen Funktionen</tooltip>
              <tooltip xml:lang="nl">Functie van de module</tooltip>
            </variable>

            <variable CV="6860.3" item="Direction" default="0">
              <enumVal>
                <enumChoice value="0">
                  <choice>when driving from sensor 1 to sensor 2</choice>
                  <choice xml:lang="de">bei Fahrtrichtung von Sensor 1 nach Sensor 2</choice>
                  <choice xml:lang="nl">in rijrichting van sensor 1 naar 2</choice>
                </enumChoice>
                <enumChoice value="1">
                  <choice>when driving from sensor 2 to sensor 1</choice>
                  <choice xml:lang="de">bei Fahrtrichtung von Sensor 2 nach Sensor 1</choice>
                  <choice xml:lang="nl">1 toets en 1 lamp</choice>
                </enumChoice>
                <enumChoice value="2">
                  <choice>in both directions (only holding point)</choice>
                  <choice xml:lang="de">in beiden Fahrtrichtungen (nur Aufenthaltsstelle)</choice>
                  <choice xml:lang="nl">in beide richtingen (alleen stopplaats)</choice>
                </enumChoice>
              </enumVal>
              <label>Function is activated:</label>
              <label xml:lang="de">Automatik wird aktiv:</label>
              <label xml:lang="nl">Functie wordt actief:</label>
              <tooltip>Driving direction, for activating the automatic function in LNCV 2.</tooltip>
              <tooltip xml:lang="de">Fahrtrichtung, in der die Automatikfunktionen gemäß LNCV 2 aktiv sind.</tooltip>
            </variable>

            <variable CV="6860.4" item="Holding Time" default="0">
              <decVal/>
              <label xml:lang="de">Aufenthaltszeit:</label>
              <label xml:lang="nl">Wachttijd:</label>
              <label>Holding time:</label>
              <tooltip>For shuttle traffic and terminus (automatic Function as set in LNCV 2). Value in seconds.</tooltip>
              <tooltip xml:lang="de">Für Pendelverkehr und Aufenthaltsstelle (Automatikfunktionen gemäß LNCV 2). Wert in Sekunden.</tooltip>
            </variable>
            <variable CV="6860.5" item="Departure Delay" default="0">
              <decVal/>
              <label xml:lang="de">Anfahrtverzögerung:</label>
              <label xml:lang="nl">Wegrijvertraging:</label>
              <label>Departure Delay:</label>
              <tooltip>Delay between switching the locomotive’s route and the departure of the waiting locomotive. Value in seconds.</tooltip>
              <tooltip xml:lang="de">Wartezeit zwischen dem Schalten der lokindividuellen Fahrstraße und dem Anfahren der wartenden Lok. Wert in Sekunden.</tooltip>
            </variable>
            <variable CV="6860.6" item="Signal Address" mask="VVVVVVVVVVVV" default="0">
              <decVal min="1" max="2000"/>
              <label xml:lang="de">Adresse des Ausfahrtsignals: </label>
              <label xml:lang="nl">Adres Vertreksein: </label>
              <label>Exit Signal Address: </label>
              <tooltip>&lt;html&gt;Solenoid address of the exit signal for the automatic mode set in LNCV 2.&lt;br\&gt;
                In automatic modes 4, 6, 20 and 22 the signal is set by the module;&lt;br\&gt;
                in automatic modes 5, 7-10, 21 and 23-26 the signal is monitored stopping the train.&lt;br\&gt;
                Note: This signal must always be specified in automatic mode. (0-2000)&lt;/html&gt;</tooltip>
              <tooltip xml:lang="de">&lt;html&gt;Magnetartikeladresse des Ausfahrtsignals zu den Automatikfunktionen gemäß LNCV 2.&lt;br\&gt;
                Bei den Automatikfunktionen 4, 6, 20 und 22 wird das Signal vom Modul gestellt;&lt;br\&gt;
                bei den Automatikfunktionen 5, 7-10, 21 und 23-26 wird das Signal für den Zughalt beobachtet.&lt;br\&gt;
                Hinweis: Dieses Signal muss im Automatikbetrieb immer angegeben werden. (0-2000)&lt;/html&gt;</tooltip>
            </variable>

            <variable CV="6860.7" item="Message 1 State" mask="1" default="1">
              <xi:include href="http://jmri.org/xml/decoders/uhlenbrock/enumStateChoice.xml"/>
              <label xml:lang="de">Bericht 1 Ereignis:</label>
              <label xml:lang="nl">Melding 1 Actie:</label>
              <label>Message 1 Event:</label>
              <tooltip>The appropriate instruction is sent, when the sensor is passed.</tooltip>
              <tooltip xml:lang="de">Der entsprechende Befehl wird ausgesendet, wenn der Sensor überfahren wird.</tooltip>
            </variable>
            <variable CV="6860.7" item="Message 1 Address" mask="10" default="1">
              <decVal min="0" max="2000"/>
              <label xml:lang="de"> Adresse</label>
              <label xml:lang="nl"> Adres:</label>
              <label> Address:</label>
              <tooltip>&lt;html&gt;0 = no address instruction is sent.&lt;br\&gt;
                2001 - 2024 = switch an Intellibox route&lt;/html&gt;</tooltip>
              <tooltip xml:lang="de">&lt;html&gt;0 = Es wird kein Adressbefehl gesendet.&lt;br\&gt;
                2001 - 2024 = Intellibox-Fahrstraße schalten&lt;/html&gt;</tooltip>
            </variable>
            <variable CV="6860.8" item="Message 2 State" mask="1" default="1">
              <xi:include href="http://jmri.org/xml/decoders/uhlenbrock/enumStateChoice.xml"/>
              <label xml:lang="de">Bericht 2 Ereignis:</label>
              <label xml:lang="nl">Melding 2 Actie:</label>
              <label>Message 2 Event:</label>
              <tooltip>The appropriate instruction is sent, when the sensor is passed.</tooltip>
              <tooltip xml:lang="de">Der entsprechende Befehl wird ausgesendet, wenn der Sensor überfahren wird.</tooltip>
            </variable>
            <variable CV="6860.8" item="Message 2 Address" mask="10" default="1">
              <decVal min="0" max="2000"/>
              <label xml:lang="de"> Adresse</label>
              <label xml:lang="nl"> Adres:</label>
              <label> Address:</label>
              <tooltip>&lt;html&gt;0 = no address instruction is sent.&lt;br\&gt;
                2001 - 2024 = switch an Intellibox route&lt;/html&gt;</tooltip>
              <tooltip xml:lang="de">&lt;html&gt;0 = Es wird kein Adressbefehl gesendet.&lt;br\&gt;
                2001 - 2024 = Intellibox-Fahrstraße schalten&lt;/html&gt;</tooltip>
            </variable>

            <variable CV="6860.9" item="Block Speed" default="0">
              <decVal min="0" max="127"/>
              <label xml:lang="de">Blockgeschwindigkeit:</label>
              <label xml:lang="nl">Snelheid in blok:</label>
              <label>Block Speed:</label>
              <tooltip>&lt;html&gt;0 = stop with the locomotive decoder’s internal delay&lt;br\&gt;
                1 = emergency stop (stop without delay)&lt;br\&gt;
                2-127 = speed step for the slow section&lt;/html&gt;</tooltip>
              <tooltip xml:lang="de">&lt;html&gt;0 = Anhalten mit der decoderinternen Verzögerung&lt;br\&gt;
                1 = Nothalt (Anhalten ohne Verzögerung)&lt;br\&gt;
                2-127 = Fahrstufe für die Langsamfahrstrecke&lt;/html&gt;</tooltip>
            </variable>
            <variable CV="6860.10" item="Block Option Delay" mask="XVVVVVVVV" default="0">
              <decVal min="0" max="255"/>
              <label xml:lang="de">Blockverzögerung:</label>
              <label xml:lang="nl">Blokvertraging:</label>
              <label>Block Delay:</label>
              <tooltip>&lt;html&gt;0 = exit signal is set to "red" after block is vacated.&lt;br\&gt;
                1-255 = status is reported after the specified time (enter in seconds).&lt;/html&gt;</tooltip>
              <tooltip xml:lang="de">&lt;html&gt;0 = Wenn danach das Blockausfahrtssignal auf „rot“ geschaltet wird.&lt;br\&gt;
                1-255 = Wenn anschließend soviel Zeit vergangen ist. Wert in Sekunden.&lt;/html&gt;</tooltip>
            </variable>
            <variable CV="6860.10" item="Block Option Signal" mask="VXXXXXXXX" default="0">
              <xi:include href="http://jmri.org/xml/decoders/parts/enum-NoYes.xml"/>
              <label xml:lang="de">Blockausfahrtssignal Rot:</label>
              <label xml:lang="nl">Zet Uitgangssein Rood:</label>
              <label>Set Exit Signal:</label>
              <tooltip>The Exit signal defined in LNCV6 is set to Stop/Red.</tooltip>
              <tooltip xml:lang="de">Zusätzlich wird das Ausfahrtssignal auf „rot“ gesetzt.</tooltip>
            </variable>

            <variable CV="6860.11" item="Automation Activation Address" mask="VVVVVVVVVVVV" default="0">
              <decVal min="0" max="2000"/>
              <label xml:lang="de">Adresse Automatikbetrieb Ein/Aus: </label>
              <label xml:lang="nl">Adres Automatisering Aan/Uit: </label>
              <label>Automation On/Off Address: </label>
              <tooltip>Solenoid address to turn Automatic Operation functions On (Red) or Off (Green). 0 = None</tooltip>
              <tooltip xml:lang="de">Magnetartikeladresse mit der ein LISSY-Empfänger deaktiviert (rot) oder aktiviert (grün) werden kann. 0 = Deaktiviert</tooltip>
            </variable>
            <variable CV="6860.12" item="Automatikfunktionen per Zugkategorie" default="0">
              <xi:include href="http://jmri.org/xml/decoders/uhlenbrock/enumLissyCategory.xml"/>
              <label xml:lang="de">Automatikfunktionen von: </label>
              <label xml:lang="nl">Automatisering door: </label>
              <label>Train-dependent mode: </label>
              <tooltip>Automation depending on train category. Applies to Function choices 4-10 and 20-26 in LNCV 2.</tooltip>
              <tooltip xml:lang="de">Automatikfunktionen per Zugkategorie. Gilt für die Funktionen 4-10 und 20-26 gemäß LNCV 2.</tooltip>
            </variable>

            <variable CV="6860.13" item="Entrance Manager Address" mask="VVVVVVVVVVVVVVVV" default="0">
              <decVal min="0" max="4095"/>
              <label xml:lang="de">Verknüpfung mit Einfahrtsmanager: </label>
              <label xml:lang="nl">Koppel aan Inrijmanager: </label>
              <label>Link to Entry Manager: </label>
              <tooltip>0 = no link between this receiver (exit manager) and an entry manager</tooltip>
              <tooltip xml:lang="de">0 = Keine Verknüpfung von dieser Empfänger/Ausfahrtsmanager mit einem Einfahrtsmanager</tooltip>
            </variable>

            <variable CV="6860.0" item="Scale Factor" mask="VVVVVVVVVVVVVVVV" default="1" comment="Board address" >
              <decVal min="0" max="65535"/>
              <label xml:lang="de">Skalierungsfaktor Geschw.: </label>
              <label xml:lang="nl">Schaalfactor Snelheid: </label>
              <label>Speed Scale Factor: </label>
              <tooltip>Scale factor = sensor separation [mm] * constant  A, see table in manual par. 8.5.6; 0 = no Speed reported</tooltip>
              <tooltip xml:lang="de">Skalierungsfaktor = Sensorabstands [mm] * der Konstante A, sehe Tabelle 7.5.6; 0 = Keine Geschw.Meldung</tooltip>
            </variable>

            <variable CV="6860.15" item="Presets Protocol" mask="XXXXXXVV" default="0">
              <xi:include href="http://jmri.org/xml/decoders/uhlenbrock/enumLissyProtocol.xml"/>
              <label xml:lang="de">Übergabeformat (ÜF): </label>
              <label xml:lang="nl">Berichtprotocol: </label>
              <label>Protocol: </label>
              <tooltip>Preset for receiver module.</tooltip>
              <tooltip xml:lang="de">Voreinstellungen für das Empfängermodul</tooltip>
            </variable>

            <variable CV="6860.15" item="Presets LokBoss" mask="XXXXXVXX" default="0">
              <xi:include href="http://jmri.org/xml/decoders/parts/enum-NoYes.xml"/>
              <label xml:lang="de">LokBoss Betrieb:</label>
              <label xml:lang="nl">LokBoss besturing:</label>
              <label>Use LOK-boss:</label>
              <tooltip>the LISSY receiver is operated with LOK-boss</tooltip>
              <tooltip xml:lang="de">Der LISSY-Empfänger wird an einem LokBoss betrieben</tooltip>
            </variable>

            <variable CV="6860.15" item="Presets Save Status" mask="XXXXXVXXX" default="1">
              <xi:include href="http://jmri.org/xml/decoders/parts/enum-NoYes.xml"/>
              <label xml:lang="de">Betriebszustand sichern:</label>
              <label xml:lang="nl">Bewaar toestand:</label>
              <label>Store operating status:</label>
              <tooltip>Save current operating status when switching power off</tooltip>
              <tooltip xml:lang="de">Aktuellen Betriebszustand beim Abschalten der Betriebsspannung sichern</tooltip>
            </variable>

        <!--TODO add CVs 20-109 LISSY-Einzelempfängers 68620 -->
        <!--LNCVs für das Schalten von Loksonderfunktionen-->
        <!--20-29   Fahrzeugadressen für Funktionsbefehle. default 20=20000 -->
        <!--30-39   Werte für die Funktionen. default 30=1-->
        <!--40-49   Optionen für die Funktionen. default 40=16-->
        <!-- all others: default = 0-->

        <!--LNCVs für die Änderung von Lokgeschwindigkeiten-->
        <!--50-59   Fahrzeugadressen für die Geschwindigkeitsänderung-->
        <!--60-69   Werte für die Geschwindigkeit-->
        <!--70-79   Optionen für die Geschwindigkeitsänderung-->

        <!--LNCVs für das Schalten von Magnetartikeln und Fahrstraßen-->
        <!--80-89   Fahrzeugadressen, die die Befehle auslösen-->
        <!--90-99   Werte zum Schalten von Magnetartikeln oder Aussenden von Rückmeldungen-->
        <!--100-109 Optionen für die Magnetartikel- oder Rückmeldefunktionen-->

        <!-- TODO add LNCVs 20-119 as Exit Manager?? in groups of 10 i.e. -->
        <!--  20 Bahnhof Gleis 1: Adresse (LNCV 0) des LISSY-Empfängers der Gleis 1 des Bahnhofs überwacht.-->
        <!--  21 Fahrstraße zu Gleis 1: Befehl zum Schalten der Fahrstraße in Intellibox oder IB-Switch,-->
        <!--       die zu Gleis 1 des Bahnhofs führt (siehe auch Kap 7.3.6)-->
        <!--  22 1. Adresse oder Zugkategorie der Lok, die Gleis 1 anfahren soll-->
        <!--  23 2. Adresse oder Zugkategorie der Lok, die Gleis 1 anfahren soll-->
        <!--  24 3. Adresse oder Zugkategorie der Lok, die Gleis 1 anfahren soll-->
        <!--  25 4. Adresse oder Zugkategorie der Lok, die Gleis 1 anfahren soll-->
        <!--  26 5. Adresse oder Zugkategorie der Lok, die Gleis 1 anfahren soll-->
        <!--  27 6. Adresse oder Zugkategorie der Lok, die Gleis 1 anfahren soll-->
        <!--  28 7. Adresse oder Zugkategorie der Lok, die Gleis 1 anfahren soll-->
        <!--  29 8. Adresse oder Zugkategorie der Lok, die Gleis 1 anfahren soll-->

        <!--  30 Bahnhof Gleis 2: Adresse (LNCV 0) des LISSY-Empfängers der Gleis 2 des Bahnhofs überwacht -->
        <!--  etc-->



        <!--  TODO add LNCVs 120-127, see manual pages 64 -->
        <!--  120 Virtuelle Adresse, mit der der Einfahrtsmanager das Umfahrgleis als belegt oder frei meldet.
            Diese Adresse (LNCV 0) darf von keinem anderen LISSY-Empfänger benutzt werden (1-4095)-->
        <!--  121 Wird nicht verwendet-->
        <!--  122-127 Adressen (1-9999) oder Zugkategorien (20001-20004) der Loks, die das Umfahrgleis automatisch befahren sollen.(1-9999, 20001-20004)-->
        <!--In English:-->
        <!--120 Address with which the Entry manager reports the passing loop as either occupied or vacant.
            This address (LNCV 0) cannot be used by any other LISSY receiver (1-4095)-->
        <!--121 Is not used-->
        <!--122-127 Addresses (1-9999) or train categories (20000-20004) of the locomotive that will automatically use the passing loop.-->

        <!--Special for #68610:-->
        <!--110-117   Locomotive addresses that will trigger the Holding time-->
        <!--120-127   Holding time in seconds (0-255)-->
        <!--The locomotive specific holding time is only available in the time controlled shuttle traffic,
        externally controlled shuttle traffic, holding point and block section modes.-->

        </variables>
    </decoder>

    <!-- Programming tabbed panes layout -->
    <pane>
      <name>LNCV Module</name>
      <name xml:lang="de">LNCV Modul</name>
      <name xml:lang="nl">LNCV Module</name>

      <column>

          <label>
            <text>&lt;html&gt;&lt;h1&gt;Lissy Receiver Settings&lt;/h1&gt;&lt;/html&gt;</text>
            <text xml:lang="nl">&lt;html&gt;&lt;h1&gt;Lissy Ontvanger Instellingen&lt;/h1&gt;&lt;/html&gt;</text>
            <text xml:lang="de">&lt;html&gt;&lt;h1&gt;Lissy Empfänger Eingaben&lt;/h1&gt;&lt;/html&gt;</text>
          </label>

          <label>
            <text>Before writing, open a Programming session using the LocoNet LNCV Tool.</text>
            <text xml:lang="nl">Voordat je waarden schrijft eerst een Programmeersessie starten met het LocoNet LNCV Gereedschap.</text>
            <text xml:lang="de">Bevor man Werten schreiben darf, zuerst mit Hilfe des LNCV Werkzeugs einen LNCV Programmieraufgang starten.</text>
            <text xml:lang="fr">Avant qu'on peut écrire des valuers, demarrez une session de programmation avec l'Util LNCV.</text>
            <text xml:lang="cs">Před zápisem hodnot otevřete relaci programování s použitím nástroje LocoNet Konfigurovat moduly LNCV.</text>
          </label>

          <separator/>

        <row>
          <column>
            <display item="Function"/>
            <display item="Direction"/>
            <display item="Automatikfunktionen per Zugkategorie"/>
            <display item="Presets Protocol"/>
            <display item="Presets LokBoss" format="checkbox"/>
            <display item="Presets Save Status" format="checkbox"/>

            <display item="Holding Time"/>
            <display item="Departure Delay"/>
            <display item="Automation Activation Address"/>
            <display item="Entrance Manager Address"/>

            <label>
              <text>  </text>
            </label>

            <row>
              <display item="Message 1 State"/>
              <display item="Message 1 Address"/>
            </row>
            <row>
              <display item="Message 2 State"/>
              <display item="Message 2 Address"/>
            </row>
            <display item="Block Speed"/>
            <display item="Block Option Delay"/>
            <display item="Block Option Signal" format="checkbox"/>
            <display item="Signal Address"/>

            <label>
              <text>  </text>
            </label>

          </column>
        </row>
      </column>

    </pane>

  </decoder-config>
