<html>
<head>
<title>LogixNG sequence</title>

<meta charset="utf-8"/>

        <!-- include the jquery.jmri library and its dependencies -->
        <script src="/js/jquery-1.11.2.min.js"></script>
        <script src="/js/json2.js"></script>
        <script src="/js/jquery.websocket.js"></script>
        <script src="/js/logger.js"></script>
        <script src="/js/jquery.jmri.js"></script>
        <script src="logixng_sequence.js"></script>
        <script type="text/javascript">
            // set the jmri global variable to null
            var jmri = null;
            $(document).ready(function() {
                // once the document is loaded, assign a $.JMRI object to
                // the jmri variable and overload two functions:
                // open() and power(state)
                jmri = $.JMRI({
                    // call getPower() when the JMRI WebSocket connection opens
                    // getPower() does two things: it requests the current power
                    // status from JMRI and it starts the power status monitor
                    // on the JMRI server.
                    open: function() {
                        jmri.getPower();
						jmri.getMemory("IM_91");
                    },


                    memory: function(name, value, data) {
						console.log("Memory name: "+name);
						console.log("Memory value: "+value);
						console.log("Memory data: "+data);
//						jmri.setMemory("IM_92", "Hej");
					},


                    throttle: function(data) {
						console.log("Throttle data: "+data);
					},







                    // when the JMRI object receives a power update, call this
                    // function, regardless of source of update
                    power: function(state) {
                        power = state;
						console.log("Power: "+power);
/*
                        switch (power) {
                            case jmri.UNKNOWN:
                                $('#powerImg').prop('src', "/images/PowerGrey.png");
                                $('#powerImg').prop('alt', "Unknown");
                                $('#powerImg').prop('title', "Unknown");
                                break;
                            case jmri.POWER_ON:
                                $('#powerImg').prop('src', "/images/PowerGreen.png");
                                $('#powerImg').prop('alt', "Powered On");
                                $('#powerImg').prop('title', "Powered On");
                                break;
                            case jmri.POWER_OFF:
                                $('#powerImg').prop('src', "/images/PowerRed.png");
                                $('#powerImg').prop('alt', "Powered Off");
                                $('#powerImg').prop('title', "Powered Off");
                                break;
                        }
*/
                    }
                });
                // trigger the initial connection to the JMRI server; this
                // method call ensures the jmri.open() method is called after
                // a timeout to begin using fall back methods for monitoring
                // items on the JMRI server even if a WebSocket connection
                // cannot be established
                jmri.connect();
                // make it possible to click on the power button to turn track
                // power on or off without using a javascript URI
                $('#powerImg').click(function(event) {
                    jmri.setPower((power === jmri.POWER_ON) ? jmri.POWER_OFF : jmri.POWER_ON);
                });
            });
        </script>




</head>
<body>
<h1>LogixNG - Sequence</h1>




<svg id="svg-object" width="800" height="800">

<!--
  <circle id="Daniel1" cx="50" cy="50" r="40" stroke="green" stroke-width="4" fill="yellow" />
  <rect id="Daniel2" x="100" y="100" width="200" height="200" stroke="green" stroke-width="4" fill="yellow" />
  <rect id="Daniel55" x="500" y="50" width="200" height="200" stroke="blue" stroke-width="4" fill="yellow"/>
  <rect id="Daniel55" x="500" y="50" width="200" height="200" stroke="blue" stroke-width="4" fill="lightgreen" transform="translate(10)"/>
  <rect id="Daniel55" x="500" y="50" width="200" height="200" stroke="blue" stroke-width="4" fill="green" transform="rotate(10)"/>
  <defs>
    <g id="DanielAA">
      <circle id="Daniel1" cx="0" cy="0" r="40" stroke="green" stroke-width="4" fill="yellow" />
      <rect id="Daniel" x="0" y="0" width="200" height="200" stroke="green" stroke-width="4" fill="yellow" />
	</g>
  </defs>

  <use id="DanielBB" x="0" y="0" xlink:href="#DanielAA"/>

  <rect id="Daniel55" x="500" y="50" width="200" height="200" stroke="blue" stroke-width="4" fill="lightgreen" transform="translate(-600,-150) rotate(10) translate(630,-50)"/>
  <rect id="Daniel55" x="500" y="50" width="200" height="200" stroke="blue" stroke-width="4" fill="lightgreen" transform="translate(-600,-150) rotate(20) translate(630,-250)"/>
-->

  <defs>
    <g id="Loco">
      <rect x="-228" y="-84" width="300" height="162" stroke="#385D8A" stroke-width="4" fill="#4F81BD" />    <!-- frame -->
      <rect x="-168" y="-40" width="240" height="80" stroke="#385D8A" stroke-width="4" fill="#4F81BD" />     <!-- panna -->
      <circle cx="-161" cy="0" r="42" stroke="#385D8A" stroke-width="4" fill="#4F81BD" />                    <!-- skorsten -->
      <rect x="72" y="-119" width="149" height="233" stroke="#385D8A" stroke-width="4" fill="#4F81BD" />     <!-- hytt -->
	</g>
  </defs>

  <use id="LocoHandle" x="0" y="0" xlink:href="#Loco"/>


  <defs>
    <g id="Car">
      <rect x="-221" y="-119" width="437" height="233" stroke="#385D8A" stroke-width="4" fill="#4F81BD" />    <!-- frame -->
      <rect x="-191" y="-93" width="381" height="186" stroke="#385D8A" stroke-width="4" fill="#4F81BD" />     <!-- panna -->
      <rect x="-191" y="-93" width="381" height="186" stroke="#385D8A" stroke-width="4" fill="#948A54" />     <!-- panna -->
	</g>
  </defs>

  <use id="CarHandle" x="0" y="0" xlink:href="#Car"/>
</svg>

<script>
// window.setInterval(myTimer, 200);

var circle = document.getElementById('Daniel1');

console.log("circle: "+circle);
/*
for (var key in circle) {
  console.log(key);
}
*/

var circle = document.getElementById('LocoHandle');
circle.setAttribute("transform", "translate(200,200) scale(0.35) rotate(0)");

var circle = document.getElementById('CarHandle');
circle.setAttribute("transform", "translate(380,200) scale(0.35) rotate(0)");


var angle = 0;

function myTimer() {
/*
//  var circle = document.getElementById('DanielAA');
  var circle = document.getElementById('DanielBB');
  var x = parseFloat(circle.getAttributeNS(null, 'x'));
//  circle.setAttributeNS(null, 'x', x + 1);
//  circle.setAttributeNS(null, 'rotate', '20deg');
//  circle.setAttributeNS(null, 'x', 0);
//  circle.setAttribute("transform", "translate(-100,-100) rotate("+angle+") translate(100,100)");
  circle.setAttribute("transform", "rotate("+angle+") translate(100,100)");
//  circle.setAttributeNS(null, 'x', 100);
*/

  
  var circle = document.getElementById('LocoHandle');
  circle.setAttribute("transform", "translate(400,200) scale(0.4) rotate("+angle+")");

//  circle.setAttributeNS(null, 'x', 400);

  angle += 10;
} 

</script>

</body>
</html>
