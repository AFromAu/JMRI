<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
  <meta name="generator" content=
  "HTML Tidy for Mac OS X (vers 31 October 2006 - Apple Inc. build 15.17), see www.w3.org">
  <!-- Copyright ($Author$) 2016 -->

  <title>JMRI: Dispatcher System</title>
  <!-- Style -->
  <meta http-equiv="Content-Type" content=
  "text/html; charset=us-ascii">
  <link rel="stylesheet" type="text/css" href="/css/default.css"
  media="screen">
  <link rel="stylesheet" type="text/css" href="/css/print.css"
  media="print">
  <link rel="icon" href="/images/jmri.ico" type="image/png">
  <link rel="home" title="Home" href="/">
  <!-- /Style -->
</head>

<body>
  <!--#include virtual="/Header.shtml" -->
  <div class="nomenu" id="mBody">
    <div id="mainContent">

      <h1>Dispatcher System</h1>

      <p>The Dispatcher System is a set of Python tools to extend the capabilities of the
      Dispatcher.</p>

      <div class="toc">
        <ul>
          <li><a href="#welcome">Welcome</a>
            <ul>
              <li><a href="#">Steps in setting up the system</a></li>
              <li><a href="#">System Requirements</a></li>
            </ul>
          </li>
          <li><a href="#">Running Stage 1 &mdash; Editing the panel</a></li>
          <li><a href="#">Running Stage 2 &mdash; Producing the transits</a></li>
          <li><a href="#">Running Stage 3 &mdash; Final checks</a></li>
          <li><a href="#">Running the Program</a>
            <ul>
              <li><a href="#">Register a Train</a></li>
              <li><a href="#">Set up a dispatch</a></li>
            </ul>
          </li>
          <li><a href="#">Editing the Signal Logic</a></li>
        </ul>
      </div>

      <a name="welcome" id="welcome"></a>
      <h2>Welcome</h2>
      <p>This is an automated system designed to enable you to run trains using the Dispatcher
      system between locations (normally sidings or stations, but really any set of blocks)
      designated by yourself.</p>

      <p>Provided you have set up a system as described in System Requirements, by pressing
      a few buttons on theSystem Generation Panel, a complete system will be set up for you
      complete with Transits, Train Info files, and buttons for you to press which will
      route trains across your layout.</p>

      <p>A network will be set up behind the scenes which will find the best route from
      the train's location to the required location, and set  in place a set of transits
      which will guide the train to the required location.</p>

      <p>The train will either stop at all stations on the route, or travel without
      stopping at intermediate stops, depending on whether express or stopping mode is
      selected</p>

      <p>Provision is made for multiple train operation, the trains stopping for each other.
      This is a feature of Dispatcher, but the system allows easy selecting of each train
      to control each one.</p>

      <p>Unfortunately there is a fault somewhere either in the program or dispatcher and
      two trains cannot work at once. The first train stops when the second starts.</p>
      
      <a id="main-content"></a>
      <h2>Steps in setting up the system</h2>

      <div class="main-content">
                
      <p></p>
      <p class="rvps3"><span class="rvts8">There are several stages to set up the system for automatic train running</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <ul style="text-indent: 0px; padding: 0; margin: 0 0 0 24px; list-style-position: outside; list-style-type: disc;">
      <li class="rvps3"><span class="rvts8">Fulfill the prerequisites, which include having speed profiled your locos that you wish to run with the system</span></li>
      </ul>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <ul style="text-indent: 0px; padding: 0; margin: 0 0 0 24px; list-style-position: outside; list-style-type: disc;">
      <li class="rvps3"><span class="rvts8">Start JMRI with no panel displayed. </span></li>
      <li class="rvps3"><span class="rvts8">The panel should have</span><br/><span class="rvts8">SignalMasts</span><br/><span class="rvts8">Signal Mast Logic</span><br/><span class="rvts8">No Transits (if there are any they will be deleted)</span><br/><span class="rvts8">No Train Info Files (if there are any they will be deleted)</span></li>
      </ul>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <ul style="text-indent: 0px; padding: 0; margin: 0 0 0 24px; list-style-position: outside; list-style-type: disc;">
      <li class="rvps3"><span class="rvts8">Bring up the Dispatcher System Panel</span></li>
      <li class="rvps3"><span class="rvts8">Run Stage1 to generate an intermediate panel with icons to move trains</span></li>
      <li class="rvps3"><span class="rvts8">Restart</span></li>
      <li class="rvps3"><span class="rvts8">Run Stage2 to generate a run system panel</span></li>
      <li class="rvps3"><span class="rvts8">Restart</span></li>
      <li class="rvps3"><span class="rvts8">Run Stage3 to check the dispatcher options</span></li>
      <li class="rvps3"><span class="rvts8">Check the system logic produced automaticlly and modify by hand</span></li>
      <li class="rvps3"><span class="rvts8">Save in a modified run panel</span></li>
      <li class="rvps3"><span class="rvts8">Run the train</span></li>
      </ul>
      
      <a id="System Requirements"></a>

      <h2>System Requirements</h2>

      <div class="main-content">
                
      <p></p>
      <p class="rvps3"><span class="rvts8">To use the Dispatcher System there are several prerequisites</span></p>
      <ul style="text-indent: 0px; padding: 0; margin: 0 0 0 24px; list-style-position: outside; list-style-type: disc;">
      <li class="rvps3"><span class="rvts8">You should have set up the system with signal masts</span></li>
      <li class="rvps3"><span class="rvts8">The locos you want to run on the system should be</span></li>
      <ul style="text-indent: 0px; padding: 0; margin: 0 0 0 48px; list-style-position: outside; list-style-type: circle;">
      <li class="rvps3"><span class="rvts8">entered in the Roster</span></li>
      <li class="rvps3"><span class="rvts8">set up with a speed profile</span></li>
      </ul></ul>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">the required stopping places (blocks) should be indicated by entering stop in the comments field for the appropriate block</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Provision is made for a station announcement to be made when a train departs from a station.</span></p>
      <p class="rvps3"><span class="rvts8">If the block name is unpronounceable, a good stop name can be entered in the comments field for the departure announcements</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Typical blocks comments would be</span></p>
      <p></p>
      
      <a id="Running Stage1 Editing the panel"></a>

      <h2>Running Stage1 Editing the panel</h2>

      <div class="main-content">
                
      <p></p>
      <p class="rvps3"><span class="rvts8">Run DispatcherSystem.py in main jython directory. Get something like this:</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem3.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">You are prompted to run Stage1 which adds all the icons required to run the system on a new panel.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">if the old panel name was WR.xml, the new panel will be WR_icons.xml</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Some checks are done first</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem4.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">The following checks are made</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <ul style="text-indent: 0px; padding: 0; margin: 0 0 0 24px; list-style-position: outside; list-style-type: disc;">
      <li class="rvps3"><span class="rvts8">All blocks have a sensor</span></li>
      <li class="rvps3"><span class="rvts8">No two blocks have the same sensor</span></li>
      <li class="rvps3"><span class="rvts8">stops are set up</span></li>
      <li class="rvps3"><span class="rvts8">all blocks have lengths</span></li>
      </ul>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">If no trains are present in the roster with speed profiles, this will be picked up, and can be corrected at run time.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">When the icons file is produced, a message similar to the following will be produced</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem5.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p></p>
      
      <a id="Running Stage2 Producing the transits"></a>

      <h2>Running Stage2 Producing the transits</h2>

      <div class="main-content">
                
      <p></p>
      <p class="rvps3"><span class="rvts8">PanelPro should be restarted and the icons file produced in stage 1 should be loaded.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">A screen similar to the following will be produced:</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem6.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Once the Stage2 button is pressed one gets a confirmatory messages:</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem7.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem8.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Transits required to move the train from stop to stop will be produced, and corresponding train-info files which contain the information required for running the train are produced. Some of the information is overwritten when the train-info files are used such as the train name, so train info files do not have to be produced for each train.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Train-info files are produced for each route allowed, and all routes are allowed which are physically possible to travel. Train-info files are produced for forward and reverse operation, so there can be quite a number produced.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Once the transits and train-info files are produced we get a message:</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem10.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">You should then restart JMRI and load the run panel, in this example WR_run.xml</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p></p>
      
      <a id="Running Stage3 Final Checks"></a>

      <h2>Running Stage3 Final Checks</h2>

      <div class="main-content">
                
      <p></p>
      <p class="rvps3"><span class="rvts8">Restart JMRI and load the newly produced run panel, in our example WR_run.xml</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Run dispatcher System again to get</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem11.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Click Stage3 and one gets two screens opening,the Dispatcher options screen and another saying the options that need to be set for the Dispatcher system to work</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem12.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem13.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Set the required option and we get a message reminding you to save the changed options</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem14.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Open the dispatcher window and </span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p></p>      
      
            <a id="Running the Program"></a>

            <h2>Running the Program</h2>

            <div class="main-content">
                
      <p></p>
      <p class="rvps3"><span class="rvts8">To run the system it is advised to have the thread monitor running (Panels =&gt; Thread Monitor)</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">You will notice several buttons in the top RH corner.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem15.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">The first two start and end the four threads required for the program to run. The threads need to be in operation for the other buttons to work.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">If one inadvertently presses the run button twice eight threads will be produced. It is best to start again. Clicking the stop Dispatcher System will close four of them, but the other will need to be closed from the Thread monitor.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts13">Choosing the Direction</span></p>
      <p class="rvps3"><span class="rvts13"><br/></span></p>
      <p class="rvps3"><span class="rvts13"><br/></span></p>
      <p class="rvps3"><span class="rvts13"><br/></span></p>
      <p class="rvps3"><span class="rvts8">&nbsp;</span></p>
      <p></p>      
      
            <a id="Register a Train"></a>

            <h2>Register a Train</h2>

            <div class="main-content">
                
      <p></p>
      <p class="rvps3"><span class="rvts8">The first step is to register a train in a siding or at a stop. Drive a train to the required stop, and press Setup Train in Siding.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">We need to tell the system which way the train is pointing. </span></p>
      <ul style="text-indent: 0px; padding: 0; margin: 0 0 0 24px; list-style-position: outside; list-style-type: disc;">
      <li class="rvps3"><span class="rvts8">At a siding it's easy there is one direction the train can go, and we say which way it is facing out of the siding</span></li>
      <li class="rvps3"><span class="rvts8">At another stop we have to indicate which way we are talking about and we highlight one direction</span></li>
      </ul>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">suppose we have the following layout</span></p>
      <p class="rvps3"><img width="893" height="203" alt="" style="padding : 1px;" src="lib/NewItem16.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts13">Choosing the Train</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">We click SetupTrain in siding</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">If the train is siding 1b as indicated one gets the following message</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem17.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Where if we click the dropdown we get all the trains in the system with a speed profile. We choose the required train and click OK</span></p>
      <p class="rvps3"><span class="rvts13"><br/></span></p>
      <p class="rvps3"><span class="rvts13">Register the Direction the train is facing</span></p>
      <p class="rvps3"><span class="rvts13"><br/></span></p>
      <p class="rvps3"><span class="rvts8">The following message then pops up</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem18.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Select the correct direction and click OK.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">The train will appear in the memory location for the block</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img width="929" height="206" alt="" style="padding : 1px;" src="lib/NewItem20.png"></p>
      <p></p>      
      
            <a id="Set up a dispatch"></a>

            <h2>Set up a dispatch</h2>

            <div class="main-content">
                
      <p></p>
      <p class="rvps3"><span class="rvts8">To set up a dispatch a train (or several trains bust be registered with the system, and located in a stop).</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Clicking a red button will allow a dispatch to be set up to that location.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Suppose one has the following layout with a train in siding1. Click the Passing Loop button as indicated to set up a dispatch to Passing Loop.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem24.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">There is an express icon. If set the train type will default to express (moves without stopping at intermediate stations), If unset, will default to stopping as shown.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem26.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem25.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Select the required train from the drop down, and a dispatch will be set up to the next stop (Siding1A).</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem27.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">The train will start moving, and the speed indicated in the Auto trains window.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem28.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">The train will move to Siding1B, stop and the dispatch will terminate, another dispatch will start up to the next stop which will be to passing loop.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p></p>   

            <a id="Editing the Signal Logic"></a>

            <h2>Editing the Signal Logic</h2>

            <div class="main-content">
                
      <p></p>
      <p class="rvps3"><span class="rvts8">Automatic Signal Logic is not perfect. I works well when there is one turnout per section, but when there are more it may get one or more routes in a section wrong.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">This can be overcome by editing the signal logic. You can see whether logic is wrong either by attempting to run a train over the route, or by setting the turnouts along the route and seeing whether the signals are green</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">In the set rout from goods siding and back one can see that the automatic signal logic failed.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem29.png"><span class="rvts8">.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Right click on the signal mast and bring up the signal mast logic editor</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><img alt="" style="padding : 1px;" src="lib/NewItem30.png"></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">You can see that for the route Board2toPT11 (the route from the bootomto top) only 2 turnouts instead of 4 are shown. The Dispatch will not work.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Delete the route, Press Add Signal Logic. And add a new route. </span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Ensure Use Layout Paths, Use Turnout Details from Layout Editor and Use Block Details from Layout Editor are ticked (this will ensure that the transits already produced will not get broken, and set up the transit. Save the panel and restert</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8">Dispatcher should now run along the route.</span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p class="rvps3"><span class="rvts8"><br/></span></p>
      <p></p>      

      <!--#include virtual="/Footer.shtml" -->
    </div><!-- closes #mainContent-->
  </div><!-- closes #mBody-->
</body>
</html>