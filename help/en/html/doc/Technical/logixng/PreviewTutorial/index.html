<html>
<head>
<title>LogixNG preview - tutorial</title>
</head>

<body>
<table width="800">
<tr>
<td>

<h2>LogixNG Preview Tutorial</h2>

This tutorial has an <a href="#">example profile</a>.

<p>

Menu choice "Tools / Tables / LogixNG" has a sub menu with three tables:
<ul>
<li>LogixNG</li>
<li>LogixNG Modules</li>
<li>LogixNG Tables</li>
</ul>

Select "Tools / Tables / LogixNG / LogixNG" to open the table with the LogixNGs. The other two tables,
"LogixNG Modules" and "LogixNG Tables", are described later in this tutorial.
<p>
On the "Meny" column, select "Edit" for the "Tutorial LogixNG". This brings up a table of ConditionalNGs that are
owned by this LogixNG. Each ConditionalNG in this tutorial has a user name starting with a number and a short
description. These user names are used as headers in this tutorial and demonstrates different things in LogixNG.

<hr>

<h2>1. Basics</h2>


<hr>

<h2>90. Local variables and scripts</h2>

A script can use local variables. But local variables only exists during the execution of the action/expression
that defines the local variable. This ConditionalNG uses the same script in three different cases, there the local
variable is a number, a string or does not exist at all.
<p>
The script is in the file AAAAAA.AA. It's loaded by the ExpressionScript expression.






<p>
Select "Edit" for a ConditionalNG to open the ConditionalNG editor.
<p>
A ConditionalNG is a tree of actions and expressions, there some actions and some expressions can have children.
<p>
The editor doesn't know anything about actions nor expressions. Instead, the editor knows about female sockets and
male sockets. The female sockets is the exclamation marks and the question marks, followed by a name, for example "A4".
The name can be any number of letters and digits, starting with a letter.
<p>
The user never sees the male sockets, but each action and expression is encapsulated in a male socket.
<p>
Each ConditionalNG may have a memo there the user may enter some text, for example a description of the ConditionalNG.
Each ConditionalNGs in the example profile has a memo that describes that ConditionalNG.
<p>


<hr>

<h2>99. Adding a new action/expression</h2>

See the package <i>jmri.jmrix.loconet.logixng</i> for the classes mentioned in this part.
<p>
How do we add a new action or expression type to LogixNG? Lets assume we want to have an expression that looks at the
LocoNet slot manager and returns true if more that 75% of the slots are not free, false otherwise.
<p>
The first thing to notice is that is expression is LocoNet specific. Which means that it should be in a sub package to
jmri.jmrix.loconet and that the expression should not be available if there is no LocoNet connection. This is easy to
do. LogixNG uses @ServiceProvider to get a list of the available actions and expressions. For example, the class
jmri.jmrit.logixng.expressions.DigitalFactory provides a list of digital expressions. We can add our own factory class
for our LocoNet expression and we can make the method <i>getExpressionClasses()</i> conditional so that it only returns
our class if there is a LocoNet connection active.
<p>
Second, it may be helpful for the user if the LocoNet actions/expressions have their own category. So lets create that.
LogixNG has an "enum" Category, but since Java enums cannot be extended, the LogixNG Category class simulates an enum
without being a true enum class. We add the LocoNet category to the Factory class and let a static initializer in the
Factory class register the LocoNet category.
<p>
Now it's time to create the expression itself. For that, we need three classes. ExpressionSlotUsage that has the
expression itself, ExpressionSlotUsageXml that stores the expression to the panel xml file and ExpressionSlotUsageSwing
that has the swing editor for this expression.
<p>
For the expression itself, ExpressionSlotUsage, there is two important things to do. First, the expression needs to do
something useful, in this case check the slots in the slot manager. The interface jmri.jmrit.logixng.DigitalExpression
defines a digital expression and what it needs to do. It has a method <i>evaluate()</i> that returns a boolean. We need
to implement this method and it's here that we check the slots in the slot manager.
<p>
The second important thing we need to do in ExpressionSlotUsage is to register and unregister any listeners. In this
case, we want to listen for changed slots so we use the methods <i>registerListenersForThisClass()</i> and
<i>unregisterListenersForThisClass()</i> to register/unregister the listeners. Please check that listeners are not
registered twice. We do that by the varable <i>_listenersAreRegistered</i> to check if listeners has already been
registered.
<p>
The swing editor ExpressionSlotUsageSwing implements the <i>SwingConfiguratorInterface</i> that is used by the
ConditionalNG editor to create and edit actions and expressions. It does that by calling the method getConfigPanel()
in the SwingConfiguratorInterface that creates a JPanel with the components that are needed to configure the
action/expression. After the user has clicked "OK" to create a new expression or to save the changes, the method
validate() is called. If it returns true, a new object is created by a call to createNewObject() or the changes are
saved to the expresion by a call to updateObject().
<p>
In the case of ExpressionSlotUsageSwing, we have a sentense like "The number of slots which 'has not' state 'COMMON or
IDLE' is 'less than' '32', there the parts within '' are JComponents that let the user select different things. But
this sentence needs to be translated to different languages and the order of words may be different in another language.
The SwingConfiguratorInterface has a method parseMessage() that takes the message that we get from the bundle, together
with the array of JComponents, and then returns a new list of JComponents there the message has been replaced by JLabel
components and there the JComponents has been ordered according to the language.





</td>
</tr>
</table>
</body>
</html>
